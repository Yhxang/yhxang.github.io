<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>快去现场</title>
<script>
var phoneWidth =  parseInt(window.screen.width);
var phoneScale = phoneWidth/640;
var ua = navigator.userAgent;
var metatxt="";
if (/Android (\d+\.\d+)/.test(ua)){
  var version = parseFloat(RegExp.$1);
  if(version>2.3){
    metatxt='<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+', maximum-scale = '+phoneScale+', target-densitydpi=device-dpi">';
  }else{
    metatxt='<meta name="viewport" content="width=640, target-densitydpi=device-dpi">';
  }
} else {
  metatxt='<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">';
}
document.write(metatxt);
</script>
<link href="css/style.css?ver=1.2" rel="stylesheet">

</head>
<body>
<div id="wrapper">
  <canvas id="canvas" width="640" height="1136" ></canvas>
  <section class="pops">
    <div class="popcont big rule">
      <img src="images/b01.png" width="514" height="823" alt="" class="popbg">
      <div class="rule1">
        <img src="images/b02.png" width="438" height="704" alt="">
        <a href="javascript:void(0);" class="rulebtn"></a>
      </div>
      <div class="rule2">
        <img src="images/b03.png" width="455" height="693" alt="">
        <a href="javascript:void(0);" class="rulebtn"></a>
      </div>
      <img src="images/b30.png" alt="" class="ruleclose">
    </div>
    <div class="popcont small login">
      <img src="images/b08.png" width="401" height="52" alt="" class="loginerror">
      <img src="images/b05.png" width="513" height="453" alt="" class="popbg">
      <img src="images/b06.png" width="462" height="219" alt="" class="loginbg">
      <input type="tel" placeholder="| 请输入您的手机号码" class="mobile0" name="mobile0" maxlength="11" value="13500000000">
      <img src="images/b07.png" width="344" height="125" alt="" class="loginbtn">
      <img src="images/b32.png" width="344" height="125" alt="" class="playgoon">
    </div>
    <div class="popcont small ready">
      <img src="images/b05.png" width="513" height="453" alt="" class="popbg">
      <img src="images/b09.png" width="455" height="279" alt="" class="readybg">
    </div>
    <div class="popcont small result">
      <img width="401" alt="" class="rstslogan">
      <img src="images/b05.png" width="513" height="453" alt="" class="popbg">
      <div class="rstcont lucky">
        <img src="images/b14.png" width="438" height="229" alt="" class="luckybg">
        <img src="images/b04.png" width="155" height="161" alt="" class="goluck">
        <p class="score">0</p>
      </div>
      <div class="rstcont pity">
        <img src="images/b16.png" width="438" height="263" alt="" class="pitybg">
        <img src="images/b17.png" width="152" height="160" alt="" class="playagain">
        <p class="score">0</p>
      </div>
      <div class="rstcont hadplay">
        <img src="images/b14.png" width="438" height="229" alt="" class="hadplaybg">
        <img src="images/b15.png" width="162" height="156" alt="" class="hadplayok">
        <p class="score">0</p>
      </div>
      <div class="rstcont fail">
        <img src="images/b33.png" width="438" height="263" alt="" class="pitybg">
        <img src="images/b17.png" width="152" height="160" alt="" class="playagain">
      </div>
    </div>
    <div class="popcont small prize">
      <img src="images/b31.png" width="401" height="54" alt="" class="prizetip">
      <img src="images/b05.png" width="513" height="453" alt="" class="popbg">
      <div class="whitebg"></div>
      <img src="" alt="" class="award">
      <img src="images/b21.png" width="388" height="92" alt="" class="prizetit">
      <img src="images/b29.png" width="341" height="129" alt="" class="getprize">
    </div>
    <div class="popcont big form">
      <img src="images/b01.png" width="514" height="823" alt="" class="popbg">
      <img src="images/b19.png" width="440" height="487" alt="" class="formbg">
      <form action="#" id="formmsg" class="formmsg" onsubmit="return false;">
        <input type="text" placeholder="| 请输入姓名" class="username" name="username">
        <input type="text" class="mobile" name="mobile" readonly="readonly" maxlength="11">
        <textarea cols="20" rows="5" wrap="soft" placeholder="| 请输入收奖地址" class="address" name="address"></textarea>
        <button id="smtbtn" class="smtbtn"><img src="images/b20.png" width="344" height="125" alt=""></button>
      </form>
    </div>
    <div class="popcont small subsuc">
      <img src="images/b05.png" width="513" height="453" alt="" class="popbg">
      <img src="images/b18.png" width="438" height="230" alt="" class="subsucbg">
      <img src="images/b15.png" width="162" height="156" alt="" class="subok">
    </div>
  </section>
  <div class="soundbtn"><i class="laba"></i></div>
  <section class="loading" id="loading">
    <div class="gifarea">
      <img src="images/loading.gif" alt="">
      <p class="num" id="num">0</p>
    </div>
  </section>
</div>
<div id="orientLayer" class="mod-orient-layer">
  <div class="mod-orient-layer__content">
    <i class="icon mod-orient-layer__icon-orient"></i>
    <div class="mod-orient-layer__desc">为了更好的体验，请使用竖屏浏览</div>
  </div>
</div>
<script src="js/jquery-3.0.0.min.js"></script>
<script src="js/createjs-2015.11.26.min.js"></script>
<script src="cover.js"></script>
<script src="map.js"></script>
<script>
var canvas, stage, exportRoot0, exportRoot, w, h;
var loader;
var mapLoaded = false;
var clickNeedLoadP2 = false;
w = window.innerWidth;
h = window.innerHeight;
var initinfo = {
    callback: "jsonp"
};
document.addEventListener("DOMContentLoaded",function(event) {
    w=$(window).width();
    h=$(window).height();
    init();
    $.ajax({
        //url: "//gsactivity.diditaxi.com.cn/gulfstream/activity/v2/h5activity/initInfo",//原项目地址
        url: "init_info.php",//演示地址
        type: "get",
        data: {
            g_channel: "hurryUp",
            callback: "jsonp"
        },
        dataType: 'json',
        //dataType: "jsonp",
        // jsonpCallback: "jsonp",
        success: function(data) {
            initinfo.timestamp = data.data.timestamp;
            initinfo.rand_num = data.data.rand_num;
            initinfo.g_channel = data.data.g_channel;
            initinfo.sign = data.data.sign
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            alert("对不起，由于网络原因请稍后重试");
        }
    })
});
function init() {
    document.getElementById("wrapper").style.height = h + "px";
    createjs.MotionGuidePlugin.install();
    canvas = document.getElementById("canvas");
    canvas.setAttribute("width", w);
    canvas.setAttribute("height", h);
    images = images || {};
    loader = new createjs.LoadQueue(false);
    loader.addEventListener("fileload", handleFileLoad0);
    loader.addEventListener("complete", handleComplete0);
    loader.loadManifest(lib0.properties.manifest);
}
function handleFileLoad0(evt) {
    if (evt.item.type == "image") {
        images0[evt.item.id] = evt.result;
    }
    $("#loading .num").text(Math.floor(100 * evt.target._numItemsLoaded / evt.target._numItems));
}
function handleComplete0(evt) {
    $("#loading").hide();
    exportRoot0 = new lib0.cover();
    stage = new createjs.Stage(canvas);
    createjs.Touch.enable(stage);
    exportRoot0.y = (h - 1136) / 2;
    stage.addChild(exportRoot0);
    stage.update();
    createjs.Ticker.setFPS(lib0.properties.fps);
    createjs.Ticker.addEventListener("tick", stage);
    loader = new createjs.LoadQueue(false);
    loader.addEventListener("fileload", handleFileLoad);
    loader.addEventListener("complete", handleComplete);
    loader.loadManifest(lib.properties.manifest);
    window.onorientationchange = function(e) {
        if (window.orientation != 0) {
            $("#orientLayer").addClass("show");
            if (App.data.gamebegin) {
                game.pause();
            }
        } else {
            $("#orientLayer").removeClass("show");
            if (App.data.gamebegin) {
                game.start();
            }
        }
    };
    var sounds = [{
        src: "bgm.mp3",
        id: "sound"
    },
    {
        src: "didi.mp3",
        id: "didi"
    }];
    createjs.Sound.alternateExtensions = ["mp3"];
    createjs.Sound.on("fileload", loadHandler);
    createjs.Sound.registerSounds(sounds, "./media/");
    function loadHandler(event) {
        App.data.bgm = createjs.Sound.play("sound");
        App.data.bgm.on("complete",
        function(e) {
            App.data.bgm.play();
        });
        App.data.bgm.volume = 0.5;
    }
    $(".soundbtn").click(function() {
        if (App.data.bgm.muted) {
            App.data.bgm.muted = false;
            $(this).removeClass("muted");
        } else {
            App.data.bgm.muted = true;
            $(this).addClass("muted");
        }
    })
}
function handleFileLoad(evt) {
    if (evt.item.type == "image") {
        images[evt.item.id] = evt.result;
    }
    $("#loading .num").text(Math.floor(100 * evt.target._numItemsLoaded / evt.target._numItems));
}
function handleComplete(evt) {
    mapLoaded = true;
    exportRoot = new lib.map();
    if (clickNeedLoadP2) {
        stage.removeChild(exportRoot0);
        stage.addChild(exportRoot);
        $("#loading").hide();
        App.showReady();
        clickNeedLoadP2 = null;
    }
    game = new Game(exportRoot);
    game.init();
    game.config(App);
}
var game;
var hadplay;
var App = {
    game: null,
    data: {
        gamebegin: false,
        username: null,
        mobile: null,
        address: null,
        hasplayed: false,
        bgm: null
    },
    copyData: function(fromData) {
        var toData = {};
        for (var i in fromData) {
            toData[i] = fromData[i];
        }
        return toData;
    },
    changePage: function() {
        if (mapLoaded) {
            stage.removeChild(exportRoot0);
            stage.addChild(exportRoot);
            App.showReady();
        } else {
            $("#loading").show();
            $(".pops").hide();
            clickNeedLoadP2 = true;
        }
    },
    showRule: function() {
        $(".pops,.rule").show();
        $(".rule1 .rulebtn").click(function() {
            $(".rule1").hide();
            $(".rule2").show();
        });
        $(".rule2 .rulebtn").click(function() {
            $(".rule2").hide();
            $(".rule1").show();
        });
        $(".ruleclose").click(function() {
            $(".pops,.rule").hide();
        })
    },
    showLogin: function() {
        var mobile = getCookie("mobile");
        if (mobile != null && mobile != "") {
            $(".mobile0").val(mobile)
        }
        $(".pops,.login").show();
        var flag = 1;
        $(".loginbtn").click(function() {
            mobile = $(".mobile0").val();
            if (mobile.length !== 11) {
                alert("请输入正确格式的手机号码")
            } else {
                App.data.mobile = mobile;
                setCookie("mobile", mobile);
                var loginData = App.copyData(initinfo);
                loginData.func = "login";
                loginData.phone = mobile;

                if (flag) {
                   ajaxlogin(loginData);
                }
            }
        });
        function ajaxlogin($data) {
            $.ajax({
                //url: "//gsactivity.diditaxi.com.cn/gulfstream/activity/v2/h5activity/submitActivity",
                url: "submit_activity.php",
                type: "get",
                data: $data,
                dataType: 'json',
                // dataType: "jsonp",
                // jsonpCallback: "jsonp",
                beforeSend: function() {
                    flag = 0;
                },
                success: function(data) {
                    flag = 1;
                    if (data.count == 0) {
                        $(".login").addClass("animOut");
                        setTimeout(function() {
                            $(".login").removeClass("animOut").hide();
                            App.changePage();
                        }, 100)
                    } else {
                        if (data.count == 1) {
                            App.data.hasplayed = true;
                            $(".loginbtn").hide();
                            $(".loginerror").show();
                            $(".playgoon").show().click(function() {
                                $(".login").addClass("animOut");
                                setTimeout(function() {
                                    $(".login").removeClass("animOut").hide();
                                    App.changePage();
                                }, 100)
                            })
                        }
                    }
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    flag = 1;
                    // console.log(XMLHttpRequest, textStatus)
                    alert("对不起，由于网络原因请稍后重试");
                }
            })
        }
    },
    showReady: function() {
        $(".pops,.ready,.soundbtn").show();
        createjs.Sound.play("didi");
        setTimeout(function() {
            $(".ready").addClass("animOut");
            setTimeout(function() {
                $(".ready").removeClass("animOut").hide()
            }, 100);
            $(".pops").hide();
            game.start();
            App.data.gamebegin = true;
        }, 1800)
    },
    showResult: function() {
        setTimeout(function() {
            $(".pops,.result").show();
            var fixscore = Math.floor(App.game.score);
            $(".score").text(fixscore);
            if (App.data.hasplayed) {
                $(".hadplay").show();
            } else {
                if (fixscore <= 25) {
                    $(".lucky").show();
                } else {
                    if (fixscore > 25) {
                        $(".pity").show();
                    }
                }
            }
            $(".rstslogan").attr("src", "images/b" + (10 + Math.ceil(Math.random() * 3)) + ".png");
        }, 1000);
        $(".hadplayok").click(function() {
            window.location.href = window.location.href + "?ran=" + Math.random();
        });
        $(".goluck").click(function() {
            var fetchActivityData = App.copyData(initinfo);
            fetchActivityData.func = "fetchActivity";
            fetchActivityData.phone = App.data.mobile;

            $.ajax({
                //url: "//gsactivity.diditaxi.com.cn/gulfstream/activity/v2/h5activity/submitActivity",
                url: "submit_activity.php",
                type: "get",
                data: fetchActivityData,
                dataType: 'json',
                // dataType: "jsonp",
                // jsonpCallback: "jsonp",
                success: function(data) {
                    switch (data.award) {
                    case 1:
                        $(".award").attr("src", "images/b28.png");
                        break;
                    case 2:
                        $(".award").attr("src", "images/b23.png");
                        break;
                    case 3:
                        $(".award").attr("src", "images/b27.png");
                        break;
                    case 4:
                        $(".award").attr("src", "images/b25.png");
                        break;
                    case 5:
                        $(".award").attr("src", "images/b24.png");
                        break;
                    case 6:
                        $(".award").attr("src", "images/b26.png");
                        break;
                    case 7:
                        $(".award").attr("src", "images/b22.png").addClass("didiquan");
                        break;
                    default:
                        break
                    }
                    $(".rstcont").hide();
                    $(".pops,.prize").show();
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    $(".fail").show();
                    alert("对不起，由于网络原因请稍后重试");
                }
            })

        }); $(".getprize").click(function() {
            if ($(".award").hasClass("didiquan")) {
                location.href = "https://gsactivity.diditaxi.com.cn/gulfstream/activity/v2/giftpackage/index?g_channel=24d672da25e089a1515cde1f4d39858d";
            } else {
                $(".popcont").hide();
                App.showForm();
            }
        }); $(".playagain").click(function() {
            window.location.href = window.location.href + "?ran=" + Math.random();
        })
    },
    showForm: function() {
        $(".pops,.form").show();
        $(".mobile").val(App.data.mobile);
        var flag = 1;
        $("#smtbtn").click(function() {
            var _username = $(".username").val();
            var _address = $(".address").val();
            if (_username.replace(/\s+/, "") == "") {
                alert("请输入姓名！")
            } else {
                if (_address.replace(/\s+/, "") == "") {
                    alert("请输入收奖地址！")
                } else {
                    App.data.username = _username;
                    App.data.address = _address;
                    var submitUserInfoData = App.copyData(initinfo);
                    submitUserInfoData.func = "submitUserInfo";
                    submitUserInfoData.phone = App.data.mobile;
                    submitUserInfoData.data = {
                        username: _username,
                        address: _address
                    };
                    if (flag) {
                        ajaxform(submitUserInfoData);
                    }
                    App.showsubresult(true);
                }
            }
        });
        function ajaxform($data) {
            $.ajax({
                //url: "//gsactivity.diditaxi.com.cn/gulfstream/activity/v2/h5activity/submitActivity",
                url: "submit_activity.php",
                type: "get",
                data: $data,
                dataType: 'json',
                // dataType: "jsonp",
                // jsonpCallback: "jsonp",
                beforeSend: function() {
                    flag = 0;
                },
                success: function(data) {
                    flag = 1;
                    App.showsubresult(true);
                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                    flag = 1;
                    alert("对不起，由于网络原因请稍后重试");
                }
            })
        }
    },
    showsubresult: function(isSuc) {
        if (isSuc) {
            $(".popcont").hide();
            $(".pops,.subsuc").show();
        } else {}
        $(".subok").click(function() {
            window.location.href = window.location.href + "?ran=" + Math.random();
        })
    }
};
function Game(root) {
    this.option = {
        mapheight: 14230,
        carbtm: 150
    };
    this.root = root;
    this.car = root.car;
    this.road = root.roadholder.road;
    this.roadshape = this.road.roadshape;
    this.dial = root.dial;
    this.uniform = 25;
    this.speed = this.uniform;
    this.hspeed = 0;
    this.vspeed = 0;
    this.rotation = 0;
    this.timer0 = null;
    this.runing = true;
    this.footballscore = [0, 0, 0];
    this.score = 0;
    this.drivetime = 0;
    this.beforePauseScore = 0;
}
Game.prototype = {
    init: function() {
        this.moveMap();
        this.configKeyboard();
        this.resize();
    },
    config: function(control) {
        this.control = control;
        control.game = this;
    },
    start: function() {
        this.timer0 = new Date();
        createjs.Ticker.on("tick", this.tick.bind(this));
    },
    pause: function() {
        this.beforePauseScore += this.drivetime;
        createjs.Ticker.removeAllEventListeners();
        createjs.Ticker.addEventListener("tick", stage);
    },
    replay: function() {},
    tick: function(e) {
        if (!this.runing) {
            return;
        }
        this.hitTestEnd(function() {
            this.hitTest();
            this.moveMap();
            this.layerFollow();
            this.timerupdate();
        }.bind(this),
        function(tgtY) {
            this.road.y += (tgtY - this.road.y) / 15;
            this.road.x += (0 - this.road.x) / 15;
            this.car.rotation += (0 - this.car.rotation) / 5;
            this.car.x += (320 - this.car.x) / 15;
            this.car.y += (h / 2 - this.car.y) / 15;
            this.layerFollow();
            if (Math.abs(h / 2 - this.car.y) < 1) {
                this.runing = false;
                this.root.gate.gotoAndPlay(1);
                createjs.Tween.get(this.car).to({
                    scaleX: 0,
                    scaleY: 0
                }, 350, createjs.Ease.backIn);
            }
        }.bind(this));
    },
    resize: function() {
        this.car.y = h - 150;
        this.root.roadholder.y = h;
    },
    turnL: function($step) {
        if(typeof $step == 'undefined'){
            this.rotation ++
        }else{
            this.rotation += $step;
        }
        this.car.rotation = -this.rotation;
    },
    turnR: function($step) {
        if(typeof $step == 'undefined'){
            this.rotation --
        }else{
            this.rotation -= $step;
        }
        
        this.car.rotation = -this.rotation;
    },
    moveMap: function(mapmc) {
        var deg = this.rotation * Math.PI / 180;
        this.hspeed = Math.sin(deg) * this.speed;
        this.vspeed = Math.cos(deg) * this.speed;
        this.road.x += this.hspeed;
        this.road.y += this.vspeed;
    },
    layerFollow: function() {
        var pt = this.road.gatepos.localToGlobal(0, 0);
        this.root.gate.x = pt.x;
        this.root.gate.y = pt.y;
    },
    hitTestEnd: function(fun1, fun2) {
        var pt = this.road.localToGlobal(this.road.endline.x, this.road.endline.y);
        if (pt.y < h - 150) {
            fun1();
        } else {
            var stadiumPt = this.road.localToGlobal(this.road.stadium.x, this.road.stadium.y);
            var targetRoadY = this.road.y + (h / 2 - stadiumPt.y);
            fun2(targetRoadY);
        }
    },
    hitTest: function() {
        var carToRoadpts = [];
        var carToWater = [];
        var carToMire = [];
        var carToTV = [];
        var carToFootball = [];
        var isHitRoad = true;
        var isHitWater = isHitMire = isHitTV = isHitFootball = false;
        for (var i = 0; i < 2; i++) {
            var pt = this.car["p" + i];
            carToRoadpts[i] = this.car.localToLocal(pt.x, pt.y, this.roadshape);
            isHitRoad = isHitRoad && this.roadshape.hitTest(carToRoadpts[i].x, carToRoadpts[i].y);
            carToWater[i] = this.car.localToLocal(pt.x, pt.y, this.road["water"]);
            isHitWater = isHitWater || this.road["water"].hitTest(carToWater[i].x, carToWater[i].y);
            carToMire[i] = this.car.localToLocal(pt.x, pt.y, this.road["mire"]);
            isHitMire = isHitMire || this.road["mire"].hitTest(carToMire[i].x, carToMire[i].y);
        }
        footballOuter: for (var i = 0; i < 2; i++) {
            var pt = this.car["p" + i];
            for (var j = 0; j < 3; j++) {
                var football = this.road["f" + j].shape;
                carToFootball[i] = this.car.localToLocal(pt.x, pt.y, football);
                isHitFootball = isHitFootball || football.hitTest(carToFootball[i].x, carToFootball[i].y);
                if (isHitFootball) {
                    if (this.footballscore[j] != 3) {
                        this.footballscore[j] = 3;
                        this.road["f" + j].gotoAndPlay(1);
                        this.dial.txt.color = "red";
                        createjs.Tween.get(this.dial).to({
                            scaleX: 1.2,
                            scaleY: 1.2
                        }, 180).to({
                            scaleX: 1,
                            scaleY: 1
                        }, 180).call(function() {
                            this.dial.txt.color = "white";
                        }.bind(this));
                    }
                    break footballOuter;
                }
            }
        }
        if (!this.speedup) {
            outer: for (var j = 0; j < 8; j++) {
                var tv = this.road["tv" + j].shape;
                for (var i = 0; i < 2; i++) {
                    carToTV[i] = this.car.localToLocal(pt.x, pt.y, tv);
                    isHitTV = isHitTV || tv.hitTest(carToTV[i].x, carToTV[i].y);
                    if (isHitTV) {
                        this.speed = 50;
                        this.road["tv" + j].gotoAndPlay(2);
                        this.speedup = true;
                        break outer;
                    }
                }
            }
        }
        function notHitRoad(_this) {
            if (!isHitRoad) {
                _this.speed = 1;
                _this.speedup = false;
            }
        }
        function hitWater(_this) {
            if (isHitWater) {
                if (_this.car.water.currentFrame == 0) {
                    _this.car.water.gotoAndStop(1);
                }
                _this.speed = 10;
                _this.speedup = false;
            } else {
                _this.car.water.gotoAndStop(0);
            }
        }
        function hitMire(_this) {
            if (isHitMire) {
                _this.speed = 10;
                _this.speedup = false;
                if (_this.car.mire.currentFrame == 0) {
                    _this.car.mire.gotoAndStop(1);
                }
            } else {
                _this.car.mire.gotoAndStop(0);
            }
        }
        if (this.speedup) {
            this.speed += (this.uniform - this.speed) / 30;
            this.car.gas.play();
            if (Math.abs(this.uniform - this.speed) < 0.5) {
                this.car.gas.gotoAndStop(1);
                this.speedup = false;
                this.speed = this.uniform;
            }
            notHitRoad(this);
            hitWater(this);
            hitMire(this);
        } else {
            this.speed = this.uniform;
            this.car.gas.gotoAndStop(0);
            notHitRoad(this);
            hitWater(this);
            hitMire(this);
        }
    },
    timerupdate: function() {
        var fscore = 0;
        for (var i = 0; i < this.footballscore.length; i++) {
            fscore += this.footballscore[i];
        }
        this.drivetime = (new Date() - this.timer0) / 1000;
        this.score = (this.beforePauseScore + this.drivetime - fscore);
        if (this.score > 99.9) {
            this.score = 99.9;
        }
        this.dial.txt.text = String(this.score.toFixed(1)).replace(/\./, "'");
    },
    configKeyboard: function() {
        document.addEventListener("keydown",
        function(evt) {
            switch (evt.which) {
            case 37:
                this.turnL(2.5);
                break;
            case 38:
                break;
            case 39:
                this.turnR(2.5);
                break;
            case 40:
                break;
            }
        }.bind(this));
        if (window.DeviceOrientationEvent) {
            window.addEventListener("deviceorientation", orientationHandler.bind(this), false);
        } else {
            alert("您的设备不支持运动传感");
        }
        function orientationHandler(event) {
            var _gamma = event.gamma;
            if (_gamma < -80) {
                _gmtarget = -80;
            } else {
                if (_gamma > 80) {
                    _gmtarget = 80;
                } else {
                    _gmtarget = _gamma;
                }
            }
            this.rotation += ( - _gmtarget - this.rotation) / 25;
            this.car.rotation = -this.rotation * 4 / 3;
        }
    }
};
function setCookie(c_name, value, expiredays) {
    var exdate = new Date();
    exdate.setDate(exdate.getDate() + expiredays);
    document.cookie = c_name + "=" + escape(value) + ((expiredays == null) ? "": ";expires=" + exdate.toGMTString());
}
function getCookie(c_name) {
    if (document.cookie.length > 0) {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1) {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) {
                c_end = document.cookie.length
            }
            return unescape(document.cookie.substring(c_start, c_end));
        }
    }
    return "";
};
</script>

<!--Mock start-->
<script src="../../../libs/mock.js"></script>
<script>
    var Mock_db = {
        timestamp: null,
        rand_num: null,
        sign: null
    }
   
    Mock.mock(/init_info\.php.*/, 'get', function(options){
        var getQueryString = getParam(new URL('http://' + options.url));
        var callback = getQueryString( 'callback');
        var g_channel = getQueryString('g_channel');
        var result = {
            errno: 0,
            errmsg: 'OK',
            backtrace: ''
        }
        if(g_channel == 'hurryUp'){
            // 生成时间戳和随机值
            Mock_db.timestamp = new Date().valueOf(); 
            Mock_db.rand_num = Math.random();
            Mock_db.sign = Mock.Random.guid().replace(/-/g,'').toLowerCase();

            result.data =  {
                timestamp: Mock_db.timestamp,
                rand_num: Mock_db.rand_num,
                token: '',
                app_type: 2,
                g_channel: 'hurryUp',
                sign: Mock_db.sign,
                activityData: []
            }
            return result
        }else {
            return {
                errno: 23333,
                errmsg: '参数错误'
            }
        }
    })

    Mock.mock(/submit_activity\.php.*/, 'get', function(options){
        var getQueryString = getParam(new URL('http://' + decodeURIComponent(options.url)));
        var callback = getQueryString('callback');
        var g_channel = getQueryString('g_channel');
        var result = {
            errno: 0,
            errmsg: 'OK',
            backtrace: ''
        }
        if(g_channel=='hurryUp'){
            if(getQueryString('timestamp') != Mock_db.timestamp){
                result = {
                    errno: 10004,
                    errmsg: 'timestamp错误'
                }
            }else if(getQueryString('rand_num') != Mock_db.rand_num){
                result = {
                    errno: 10005,
                    errmsg: 'rand_num错误'
                }
            }else if(getQueryString('sign') != Mock_db.sign){
                result = {
                    errno: 10006,
                    errmsg: 'sign错误'
                }
            }else{
                var func = getQueryString('func')
                if(func == 'login'){
                    if(String(getQueryString('phone')).length != 11){
                        result = {
                            errno: 10009,
                            errmsg: '不合法的手机号'
                        }
                        return result
                    }else{
                        result.count = 0 
                    }
                }else if(func == 'fetchActivity'){
                    result.award = (function(max, min){
                        return Math.floor(Math.random() * (max + 1 - min)) + min
                    })(7, 1)
                }else if(func == 'submitUserInfo'){
                    if(!getQueryString('data[username]')){
                        result = {
                            errno: 10007,
                            errmsg: '没有用户名'
                        }
                    }else if(!getQueryString('data[address]')){
                        result = {
                            errno: 10008,
                            errmsg: '没有地址'
                        }
                    }else if(String(getQueryString('phone')).length != 11){
                        result = {
                            errno: 10009,
                            errmsg: '不合法的手机号'
                        }
                    }else{
                        result = {
                            errno: 0,
                            errmsg: 'OK',
                            backtrace: ''
                        }
                    }
                }else{
                    result = {
                        errno: 10010,
                        errmsg: '不合法的func'
                    }
                }
                return result;
            }
        }else{
            return {
                errno: 23333,
                errmsg: '参数错误'
            }
        }
    })

    function getParam($URL){
        return function ($attr){
            return $URL.searchParams.get($attr)
        }
    }
</script>
<!--Mock end-->
</body>
</html>